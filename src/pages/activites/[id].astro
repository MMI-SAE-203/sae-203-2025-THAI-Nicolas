---
import Layout from "../../layouts/Layout.astro"
import { getActivitesById } from "../../../backend/backend.mjs"
const { id } = Astro.params;
const activite = await getActivitesById(id);

import { formatDate, getAllEvents } from "../../../backend/backend.mjs";
import CardEvenements from "../../components/CardEvenements.astro";
const formatDeLaDate = formatDate(activite.date_projection);

// Récupérer tous les événements et filtrer uniquement ceux de type "Activite"
const allEvents = await getAllEvents();
const autresActivites = allEvents
  .filter(event => event.type === "Activite" && event.id_original !== id) // Exclure l'activité actuelle
  .slice(0, 3); // Optionnel: limiter à 3 activités pour ne pas surcharger la page

if (!activite) {
    return Astro.redirect("/activites")
}
---

<Layout>
    <section>
        <header>
            <h1>{activite.titre}</h1>
        </header>
        <div class="flex flex-col gap-8">
            <div class="flex justify-center items-center mx-auto">
                <img src={activite.img} alt="Image de l'activité">
            </div>
            <div class="flex flex-col justify-center mx-auto gap-2">
                <p class="font-bold text-start">
                    DATE : <span class="font-normal">{formatDeLaDate}</span>
                </p>
                <p class="font-bold text-start">
                    LIEU : <span class="font-normal" >{activite.lieu}</span>
                </p>
                <p class="font-bold text-start">
                    LIMITE D'AGE : <span class="font-normal">-{activite.limite_age} ans</span>
                </p>
                <p class="font-bold text-start">
                    DUREE : <span class="font-normal">{activite.duree} min</span>
                </p>
                <p class="font-bold text-start">
                    ANIMATEUR : <span class="font-normal">{activite.expand?.animateur.prenom} {activite.expand?.animateur.nom}</span>
                </p>
            </div>
        </div>


    </section>

    <section>
        <header>
            <h2>Description de l'activité</h2>
            <div set:html={activite.description} />
        </header>
    </section>

    <section>
        <header>
            <h2>Au Programme</h2>
            <div set:html={activite.programme} />
        </header>
    </section>

    <section class="">
        <header class="mb-6">
            <h2 class="text-2xl font-bold text-center">Autres activités</h2>
        </header>
        
        {autresActivites.length > 0 ? (
            <ul class="flex flex-col md:flex-row flex-wrap justify-center gap-8">
                {
                    autresActivites.map((evenement) => (
                        <li class="w-full md:w-1/2 lg:w-1/3 max-w-md mx-auto">
                            <CardEvenements {...evenement} />
                        </li>
                    ))
                }
            </ul>
        ) : (
            <p class="text-center text-gray-600">Aucune autre activité n'est disponible pour le moment.</p>
        )}
    </section>
    

</Layout>